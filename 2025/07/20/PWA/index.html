<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    
    
    <title>PWA | Yoyo&#39;s blog</title>
    
    <link rel="alternative" href="/atom.xml" title="Yoyo&#39;s blog" type="application/atom+xml">
    
    
<link rel="stylesheet" href="/css/style.css">

    
    <link rel="stylesheet" href="/libs/fancybox/jquery.fancybox.css" charset="utf-8">
    
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
<!-- hexo injector head_end start --><script src="./func.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head>
<body class="site">
    <!-- é®ç½©å±‚ -->
    <div id="mask-layer">
    </div>
    
    <header class="site-header">
        <h1 class="site-title"><a href="/">Yoyo&#39;s blog</a></h1>
        <nav class="site-nav">
            <ul class="nav">
                
                <li><a href="/">Home</a></li>
                
                <li><a href="/archives">Archives</a></li>
                
                
                <li><a href="/atom.xml" title="RSS Feed">rss</a></li>
                
                <li><a class="toggle-search" href="#search">search</a></li>
            </ul>
        </nav>
        <div class="site-search" id="search">
            <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="https://70v-yoyo.github.io"></form>
        </div>
        
            <div class="site-header-background" style="background-image:url('http://reumia.github.io/hexo-theme-zzoman2015/images/background-zzoman2015.jpg')"></div>
        
    </header>
    <div class="site-body">
        <div class="global-width">
    <article class="article" data-layout="post" data-slug="PWA">
        <div class="article-content">
            
            
            <header class="article-header">
                <div class="article-meta">
                    <a href="/2025/07/20/PWA/" class="article-date">
  <time datetime="2025-07-20T08:21:08.000Z">2025-07-20</time>
</a>
                    
                    
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/frontend/" rel="tag">frontend</a></li></ul>

                </div>
                
    <h1 class="article-title" itemprop="name">
      <a href="/2025/07/20/PWA/">PWA</a>
    </h1>

            </header>
            
            <div class="article-body">
                <meta name="referrer" content="no-referrer" />

<blockquote>
<p>ç‰ˆæœ¬ï¼š250720<br>PWAï¼ˆæ¸è¿›å¼ Web åº”ç”¨ï¼ŒProgressive Web Appï¼‰ 2015æå‡ºã€‚</p>
</blockquote>
<ul>
<li>é‡ç‚¹ï¼šç¦»çº¿ä½¿ç”¨ã€æ·»åŠ åˆ°ä¸»å±å¹•ã€manifest.jsonã€httpsã€service worker</li>
</ul>
<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>PWA æ˜¯ä¸€ç§æå‡ Web åº”ç”¨ä½“éªŒçš„æŠ€æœ¯ï¼Œä½¿å…¶å…·å¤‡ä¸åŸç”Ÿåº”ç”¨ç›¸ä¼¼çš„åŠŸèƒ½å’Œæ€§èƒ½ã€‚PWAä¸ä»…èƒ½å¤Ÿåœ¨ç½‘é¡µä¸Šè¿è¡Œï¼Œè¿˜èƒ½åœ¨æ‰‹æœºæˆ–æ¡Œé¢ä¸Šåƒä¼ ç»Ÿçš„ç§»åŠ¨åº”ç”¨ä¸€æ ·è¿›è¡Œäº¤äº’ï¼ŒåŒæ—¶ä¿ç•™äº†Webåº”ç”¨çš„çµæ´»æ€§ã€‚<br>å®ƒé€šè¿‡å€ŸåŠ©ä¸€äº›å…ˆè¿›çš„åŠŸèƒ½ï¼Œå¦‚Service Workersã€Web App Manifest å’Œ Push Notifications ç­‰ï¼Œæ¥æå‡ç”¨æˆ·ä½“éªŒã€ä¼˜åŒ–æ€§èƒ½ï¼Œå¹¶èƒ½åœ¨ç¦»çº¿æˆ–ä½ç½‘é€Ÿç¯å¢ƒä¸‹ä¾ç„¶ä¿æŒå¯ç”¨æ€§ã€‚<br>PWA å¼ºè°ƒçš„æ˜¯â€œæ¸è¿›å¼â€ï¼Œå³å¯ä»¥æ ¹æ®è®¾å¤‡çš„èƒ½åŠ›é€æ­¥å¢å¼ºå…¶åŠŸèƒ½ã€‚</p>
<ul>
<li>ä¸»è¦ç‰¹ç‚¹ï¼š<ul>
<li>ç¦»çº¿æ”¯æŒï¼š ä½¿ç”¨ Service Workerï¼Œå¯ä»¥ä½¿åº”ç”¨åœ¨æ²¡æœ‰ç½‘ç»œè¿æ¥æ—¶ä¹Ÿèƒ½è¿è¡Œã€‚Service Worker æ˜¯ä¸€ç§æµè§ˆå™¨åå°è„šæœ¬ï¼Œèƒ½å¤Ÿæ‹¦æˆªå¹¶ç¼“å­˜ç½‘ç»œè¯·æ±‚ï¼Œä½¿å¾— Web åº”ç”¨åœ¨ç¦»çº¿çŠ¶æ€ä¸‹ä»ç„¶èƒ½å¤Ÿç»§ç»­å·¥ä½œã€‚</li>
<li>æ¨é€é€šçŸ¥ï¼š PWA å¯ä»¥å‘ç”¨æˆ·æ¨é€é€šçŸ¥ï¼Œå³ä½¿ä»–ä»¬æ²¡æœ‰æ‰“å¼€åº”ç”¨&#x2F;åº”ç”¨æ²¡æœ‰è¿è¡Œï¼Œæå‡ç”¨æˆ·å‚ä¸åº¦ã€‚</li>
<li>å“åº”å¼è®¾è®¡ï¼š PWA å…·æœ‰å“åº”å¼è®¾è®¡ï¼Œå¯ä»¥é€‚åº”ä¸åŒçš„å±å¹•å°ºå¯¸å’Œè®¾å¤‡ï¼Œæä¾›ä¸€è‡´çš„ç”¨æˆ·ä½“éªŒã€‚</li>
<li>å®‰è£…åˆ°ä¸»å±å¹•ï¼šé€šå¸¸é€šè¿‡ Web App Manifest æ–‡ä»¶é…ç½®ï¼Œå®ƒæä¾›äº†æœ‰å…³åº”ç”¨å¤–è§‚ã€åç§°ã€å›¾æ ‡ç­‰ä¿¡æ¯ã€‚<br>  PWA å¯ä»¥é€šè¿‡æµè§ˆå™¨ç›´æ¥å®‰è£…åˆ°è®¾å¤‡çš„ä¸»å±å¹•ï¼Œç”¨æˆ·åƒå®‰è£…æœ¬åœ°åº”ç”¨ä¸€æ ·ï¼Œç›´æ¥å¯åŠ¨ PWAï¼Œè€Œæ— éœ€ç»è¿‡åº”ç”¨å•†åº—ã€‚å®‰è£…åï¼ŒPWA ä¼šåƒåŸç”Ÿåº”ç”¨ä¸€æ ·è¿è¡Œï¼Œä¸”ä¸æ˜¾ç¤ºæµè§ˆå™¨ç•Œé¢ã€‚</li>
<li>å¿«é€ŸåŠ è½½ï¼š é€šè¿‡èµ„æºç¼“å­˜ã€æ‡’åŠ è½½å’Œå…¶ä»–æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µï¼ŒPWA å¯ä»¥æä¾›æ¯”ä¼ ç»Ÿ Web åº”ç”¨æ›´å¿«é€Ÿçš„åŠ è½½ä½“éªŒã€‚</li>
<li>è‡ªæ›´æ–°ï¼šPWA å¯ä»¥åœ¨åå°è‡ªåŠ¨æ›´æ–°å†…å®¹å’Œèµ„æºï¼Œä½¿å¾—ç”¨æˆ·å§‹ç»ˆä½“éªŒåˆ°æœ€æ–°ç‰ˆæœ¬çš„åº”ç”¨ã€‚</li>
<li>æé«˜æ€§èƒ½<br>  ç”±äº Service Worker èƒ½å¤Ÿç¼“å­˜é‡è¦èµ„æºï¼ŒPWA å¯ä»¥å¤§å¹…åº¦æé«˜åº”ç”¨çš„åŠ è½½é€Ÿåº¦ï¼Œå‡å°‘ç½‘ç»œè¯·æ±‚ã€‚</li>
</ul>
</li>
<li>ä½¿ç”¨åœºæ™¯ï¼š<br>éœ€è¦åœ¨æ²¡æœ‰ç¨³å®šç½‘ç»œçš„æƒ…å†µä¸‹å·¥ä½œï¼Œå¦‚ç¦»çº¿æ–‡æ¡£ç¼–è¾‘å™¨ã€ç¦»çº¿æ–°é—»é˜…è¯»å™¨ç­‰ã€‚<br>éœ€è¦æå‡ç”¨æˆ·å‚ä¸åº¦çš„åº”ç”¨ï¼Œé€šè¿‡æ¨é€é€šçŸ¥ä¸ç”¨æˆ·ä¿æŒäº’åŠ¨ã€‚<br>éœ€è¦è·¨å¹³å°åº”ç”¨å¹¶æä¾›ä¸åŸç”Ÿåº”ç”¨ç›¸ä¼¼ä½“éªŒçš„ Web åº”ç”¨ã€‚</li>
</ul>
<h2 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h2><ul>
<li>PWA çš„æŠ€æœ¯ç»„æˆ</li>
</ul>
<ol>
<li>Web App Manifest<br>è¿™æ˜¯ä¸€ä¸ªJSONæ–‡ä»¶ï¼Œå‘Šè¯‰æµè§ˆå™¨å¦‚ä½•æ˜¾ç¤ºåº”ç”¨ï¼ŒåŒ…æ‹¬åº”ç”¨çš„åç§°ã€å›¾æ ‡ã€å¯åŠ¨é¡µé¢ã€ä¸»é¢˜é¢œè‰²ç­‰ã€‚å®ƒå…è®¸ç”¨æˆ·å°† PWA æ·»åŠ åˆ°ä¸»å±å¹•å¹¶åƒåŸç”Ÿåº”ç”¨ä¸€æ ·ä½¿ç”¨ã€‚</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;My PWA App&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;short_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PWA&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;start_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;display&quot;</span><span class="punctuation">:</span> <span class="string">&quot;standalone&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;background_color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#ffffff&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;theme_color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#0000ff&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;icons&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span> <span class="string">&quot;icons/icon-192x192.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sizes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;192x192&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span> <span class="string">&quot;icons/icon-512x512.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sizes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;512x512&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>Service Worker<br>Service Worker æ˜¯ä¸€ä¸ªåœ¨æµè§ˆå™¨åå°è¿è¡Œçš„è„šæœ¬ï¼Œå®ƒå¯ä»¥æ‹¦æˆªç½‘ç»œè¯·æ±‚ï¼Œç¼“å­˜èµ„æºå¹¶æä¾›ç¦»çº¿æ”¯æŒã€‚Service Worker è¿˜å¯ä»¥å®ç°æ¨é€é€šçŸ¥å’Œåå°æ•°æ®åŒæ­¥ç­‰åŠŸèƒ½ã€‚</li>
</ol>
<p>ç¼–å†™ Service Worker æ³¨å†Œè„šæœ¬<br>åœ¨ä½ çš„ä¸»æ–‡ä»¶ï¼ˆä¾‹å¦‚ index.js æˆ– app.jsï¼‰ä¸­è°ƒç”¨ registerServiceWorker<br>ç¡®ä¿ä½ çš„ manifest.json æ–‡ä»¶é…ç½®æ­£ç¡®</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// registerServiceWorker.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">register</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">&#x27;serviceWorker&#x27;</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;load&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> swUrl = <span class="string">`<span class="subst">$&#123;process.env.PUBLIC_URL&#125;</span>/service-worker.js`</span>;  <span class="comment">// æŒ‡å®š Service Worker çš„è·¯å¾„</span></span><br><span class="line">      navigator.<span class="property">serviceWorker</span></span><br><span class="line">        .<span class="title function_">register</span>(swUrl)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">registration</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Service Worker registered with scope: &#x27;</span>, registration.<span class="property">scope</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Service Worker registration failed: &#x27;</span>, error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">unregister</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">&#x27;serviceWorker&#x27;</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">    navigator.<span class="property">serviceWorker</span>.<span class="property">ready</span></span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">registration</span> =&gt;</span> &#123;</span><br><span class="line">        registration.<span class="title function_">unregister</span>()</span><br><span class="line">          .<span class="title function_">then</span>(<span class="function"><span class="params">success</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (success) &#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Service Worker unregistered&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Service Worker unregistration failed: &#x27;</span>, error);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js æˆ– app.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; register &#125; <span class="keyword">from</span> <span class="string">&#x27;./registerServiceWorker&#x27;</span>;  <span class="comment">// å¯¼å…¥ register å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œ Service Worker</span></span><br><span class="line"><span class="title function_">register</span>();</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">React.StrictMode</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">React.StrictMode</span>&gt;</span></span>,</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åˆ›å»º Service Worker è„šæœ¬<br>åœ¨ service-worker.js ä¸­ï¼Œä½ å¯ä»¥ç¼“å­˜åº”ç”¨èµ„æºï¼Œå¤„ç†ç¦»çº¿è¯·æ±‚ç­‰ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// service-worker.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">CACHE_NAME</span> = <span class="string">&#x27;my-cache-v1&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> urlsToCache = [</span><br><span class="line">  <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;/index.html&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;/styles.css&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;/script.js&#x27;</span>, <span class="comment">// ä½ æ‰€æœ‰çš„é™æ€æ–‡ä»¶ï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨é€šé…ç¬¦</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®‰è£…é˜¶æ®µï¼Œç¼“å­˜é™æ€èµ„æº</span></span><br><span class="line">self.<span class="title function_">addEventListener</span>(<span class="string">&#x27;install&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">  event.<span class="title function_">waitUntil</span>(</span><br><span class="line">    caches.<span class="title function_">open</span>(<span class="variable constant_">CACHE_NAME</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">cache</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Opened cache&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> cache.<span class="title function_">addAll</span>(urlsToCache);</span><br><span class="line">      &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¿€æ´»é˜¶æ®µï¼Œæ¸…ç†è¿‡æ—¶çš„ç¼“å­˜</span></span><br><span class="line">self.<span class="title function_">addEventListener</span>(<span class="string">&#x27;activate&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> cacheWhitelist = [<span class="variable constant_">CACHE_NAME</span>];</span><br><span class="line">  event.<span class="title function_">waitUntil</span>(</span><br><span class="line">    caches.<span class="title function_">keys</span>().<span class="title function_">then</span>(<span class="function"><span class="params">cacheNames</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(</span><br><span class="line">        cacheNames.<span class="title function_">map</span>(<span class="function"><span class="params">cacheName</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (!cacheWhitelist.<span class="title function_">includes</span>(cacheName)) &#123;</span><br><span class="line">            <span class="keyword">return</span> caches.<span class="title function_">delete</span>(cacheName);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      );</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‹¦æˆªç½‘ç»œè¯·æ±‚ï¼Œä½¿ç”¨ç¼“å­˜å“åº”è¯·æ±‚</span></span><br><span class="line">self.<span class="title function_">addEventListener</span>(<span class="string">&#x27;fetch&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">  event.<span class="title function_">respondWith</span>(</span><br><span class="line">    caches.<span class="title function_">match</span>(event.<span class="property">request</span>).<span class="title function_">then</span>(<span class="function"><span class="params">cachedResponse</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (cachedResponse) &#123;</span><br><span class="line">        <span class="keyword">return</span> cachedResponse;  <span class="comment">// å¦‚æœç¼“å­˜ä¸­æœ‰åŒ¹é…çš„èµ„æºï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">fetch</span>(event.<span class="property">request</span>);  <span class="comment">// å¦åˆ™æ­£å¸¸è¯·æ±‚</span></span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>HTTPS<br>PWA å¼ºçƒˆæ¨èä½¿ç”¨ HTTPSï¼Œå› ä¸º Service Worker åªèƒ½åœ¨å®‰å…¨çš„ç¯å¢ƒä¸‹è¿è¡Œï¼Œä¸” HTTPS æä¾›äº†æ›´é«˜çš„å®‰å…¨æ€§ã€‚</li>
</ol>
<h2 id="vueé¡¹ç›®"><a href="#vueé¡¹ç›®" class="headerlink" title="vueé¡¹ç›®"></a>vueé¡¹ç›®</h2><p>åœ¨ Vue + Vite é¡¹ç›®ä¸­å®ç° ç¦»çº¿ç¼“å­˜ï¼ˆç¦»çº¿ä¹Ÿèƒ½è®¿é—®ï¼‰ çš„æœ€ä½³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ PWAï¼ˆProgressive Web Appï¼‰æŠ€æœ¯ã€‚ä½ å¯ä»¥ä½¿ç”¨å®˜æ–¹æ¨èçš„æ’ä»¶ï¼švite-plugin-pwaï¼Œæ”¯æŒç¦»çº¿ç¼“å­˜ã€è‡ªåŠ¨æ³¨å†Œ Service Workerã€æ›´æ–°æœºåˆ¶ç­‰ã€‚<br><code>yarn add vite-plugin-pwa -D</code><br>ä¿®æ”¹vite.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">VitePWA</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-pwa&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">vue</span>(),</span><br><span class="line">    <span class="title class_">VitePWA</span>(&#123;</span><br><span class="line">      <span class="attr">registerType</span>: <span class="string">&#x27;autoUpdate&#x27;</span>, <span class="comment">// è‡ªåŠ¨æ›´æ–° Service Worker</span></span><br><span class="line">      <span class="attr">includeAssets</span>: [<span class="string">&#x27;favicon.svg&#x27;</span>, <span class="string">&#x27;robots.txt&#x27;</span>], <span class="comment">// å¯é€‰ï¼šç¼“å­˜é¢å¤–èµ„æº</span></span><br><span class="line">      <span class="attr">manifest</span>: &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;My Vue App&#x27;</span>,</span><br><span class="line">        <span class="attr">short_name</span>: <span class="string">&#x27;VueApp&#x27;</span>,</span><br><span class="line">        <span class="attr">description</span>: <span class="string">&#x27;æˆ‘çš„ç¦»çº¿ Vue åº”ç”¨&#x27;</span>,</span><br><span class="line">        <span class="attr">theme_color</span>: <span class="string">&#x27;#ffffff&#x27;</span>,</span><br><span class="line">        <span class="attr">icons</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">src</span>: <span class="string">&#x27;pwa-192x192.png&#x27;</span>,</span><br><span class="line">            <span class="attr">sizes</span>: <span class="string">&#x27;192x192&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;image/png&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">src</span>: <span class="string">&#x27;pwa-512x512.png&#x27;</span>,</span><br><span class="line">            <span class="attr">sizes</span>: <span class="string">&#x27;512x512&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;image/png&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼“å­˜publicä¸‹æ‰€æœ‰æ–‡ä»¶ </span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">VitePWA</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-pwa&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title class_">VitePWA</span>(&#123;</span><br><span class="line">      <span class="attr">registerType</span>: <span class="string">&#x27;autoUpdate&#x27;</span>,</span><br><span class="line">      <span class="attr">includeAssets</span>: [<span class="string">&#x27;favicon.ico&#x27;</span>, <span class="string">&#x27;robots.txt&#x27;</span>, <span class="string">&#x27;**/*&#x27;</span>], <span class="comment">// âœ… æ˜¾å¼åŒ…å« public ä¸‹æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">      <span class="attr">workbox</span>: &#123;</span><br><span class="line">        <span class="attr">globPatterns</span>: [<span class="string">&#x27;**/*.&#123;js,css,html,ico,png,svg,json,txt,woff2&#125;&#x27;</span>], <span class="comment">// âœ… ç¼“å­˜è¿™äº›åç¼€çš„æ–‡ä»¶</span></span><br><span class="line">        <span class="attr">runtimeCaching</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">urlPattern</span>: <span class="regexp">/^\/.*\.(json|png|ico|svg|html|js|css|txt)$/</span>,</span><br><span class="line">            <span class="attr">handler</span>: <span class="string">&#x27;CacheFirst&#x27;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="attr">cacheName</span>: <span class="string">&#x27;static-assets&#x27;</span>,</span><br><span class="line">              <span class="attr">expiration</span>: &#123;</span><br><span class="line">                <span class="attr">maxEntries</span>: <span class="number">1000</span>,</span><br><span class="line">                <span class="attr">maxAgeSeconds</span>: <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">30</span>, <span class="comment">// ç¼“å­˜ 30 å¤©</span></span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>é…ç½®é¡¹</th>
<th>ç”¨é€”</th>
<th>æ‰§è¡Œæ—¶æœº</th>
<th>ä½œç”¨èŒƒå›´</th>
</tr>
</thead>
<tbody><tr>
<td><code>includeAssets</code></td>
<td>ğŸ‘‡æ„å»ºæ—¶å¤åˆ¶åˆ° <code>dist/</code>ï¼Œå¹¶åŠ å…¥åˆ° PWA èµ„æºæ¸…å•</td>
<td>æ„å»ºæ—¶</td>
<td>ä¸»è¦é’ˆå¯¹ <code>public/</code> ç›®å½•çš„èµ„æº</td>
</tr>
<tr>
<td><code>globPatterns</code></td>
<td>ğŸ‘‡æ„å»ºæ—¶è®© Workbox è‡ªåŠ¨ç¼“å­˜åŒ¹é…çš„é™æ€èµ„æº</td>
<td>æ„å»ºæ—¶</td>
<td>æ‰€æœ‰ <code>dist/</code> ä¸­èƒ½åŒ¹é…çš„æ–‡ä»¶</td>
</tr>
<tr>
<td><code>urlPattern</code></td>
<td>ğŸ‘‡è¿è¡Œæ—¶æ‹¦æˆªæŸäº›è¯·æ±‚å¹¶å†³å®šæ˜¯å¦ç¼“å­˜ã€å¦‚ä½•ç¼“å­˜</td>
<td>è¿è¡Œæ—¶ï¼ˆæµè§ˆå™¨ç«¯ï¼‰</td>
<td>ä»»æ„è¿è¡Œæ—¶èµ„æºï¼ˆAPIã€å›¾ç‰‡ç­‰ï¼‰</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>ç¤ºä¾‹èµ„æº</th>
<th>æ¨èç”¨æ³•</th>
</tr>
</thead>
<tbody><tr>
<td>é™æ€èµ„æº</td>
<td><code>/robots.txt</code>ã€favicon</td>
<td>âœ… <code>includeAssets</code> + <code>globPatterns</code></td>
</tr>
<tr>
<td>å…¬å…± JSON</td>
<td><code>/data/config.json</code></td>
<td>âœ… <code>includeAssets</code> or runtimeCaching</td>
</tr>
<tr>
<td>æ¥å£æ•°æ®</td>
<td><code>/api/user/list</code></td>
<td>âœ… <code>runtimeCaching.urlPattern</code></td>
</tr>
<tr>
<td>å›¾ç‰‡èµ„æº</td>
<td><code>/images/logo.png</code></td>
<td>âœ… <code>globPatterns</code> + <code>runtimeCaching</code></td>
</tr>
</tbody></table>
<p>æ·»åŠ å›¾æ ‡æ–‡ä»¶ï¼ˆæ”¾åœ¨ public&#x2F; ç›®å½•ï¼‰<br>åœ¨å…¥å£æ–‡ä»¶æ³¨å†Œ Service Worker:  å¦‚æœä½¿ç”¨ vite-plugin-pwa çš„ autoUpdateï¼Œä½ ä¸éœ€è¦æ‰‹åŠ¨æ³¨å†Œï¼Œæ’ä»¶ä¼šè‡ªåŠ¨å¸®ä½ åšã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">&#x27;serviceWorker&#x27;</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;load&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    navigator.<span class="property">serviceWorker</span>.<span class="title function_">register</span>(<span class="string">&#x27;/sw.js&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ„å»ºé¡¹ç›®å¹¶éƒ¨ç½²ï¼Œæç¤º â€œå®‰è£…åº”ç”¨â€ï¼Œå¹¶å…·å¤‡ ç¦»çº¿è®¿é—®èƒ½åŠ›ã€‚</p>
<ul>
<li><p>æµ‹è¯•<br>æ‰“å¼€æµè§ˆå™¨è®¿é—®ä½ çš„é¡¹ç›®<br>F12 æ‰“å¼€å¼€å‘è€…å·¥å…· â†’ åº”ç”¨ï¼ˆApplicationï¼‰ â†’ Service Workers<br>æ–­ç½‘ï¼Œå†åˆ·æ–°é¡µé¢ï¼Œé¡µé¢ä¾ç„¶èƒ½æ‰“å¼€ï¼Œè¯´æ˜ç¦»çº¿ç¼“å­˜æˆåŠŸ<br>&#x3D;&#x3D;service workeråªèƒ½åœ¨ HTTPSç¯å¢ƒ&#x2F;localhostæœ¬åœ°æµ‹è¯•ç¯å¢ƒ ä¸­ä½¿ç”¨&#x3D;&#x3D;ï¼Œå¦åˆ™æµè§ˆå™¨ä¼šé˜»æ­¢<br><img src="/images/PWA.assets/72539167289a4ac89c892ebcc2951665.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>service workerçš„ä¸œè¥¿åœ¨cache storageé‡Œé¢<br><img src="/images/PWA.assets/46d4b16d2d4941e8aa405312fde58ba8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>safariåªèƒ½çœ‹æ˜¯å¦å¼€å¯ï¼Œçœ‹ä¸äº†å­˜çš„å†…å®¹<br><img src="/images/PWA.assets/5c7b05ead466403e833435eafdb15f99.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
</li>
<li><p>æ§åˆ¶å“ªäº›èµ„æºç¼“å­˜<br>ä½¿ç”¨ workbox çš„ runtimeCaching æ¥é…ç½®è·¯ç”±ç¼“å­˜ç­–ç•¥</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">VitePWA</span>(&#123;</span><br><span class="line">  <span class="attr">workbox</span>: &#123;</span><br><span class="line">    <span class="attr">runtimeCaching</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">urlPattern</span>: <span class="regexp">/^https:\/\/your-api\.com\/.*$/</span>,</span><br><span class="line">        <span class="attr">handler</span>: <span class="string">&#x27;NetworkFirst&#x27;</span>,</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="attr">cacheName</span>: <span class="string">&#x27;api-cache&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>&#x3D;&#x3D;æ³¨æ„&#x3D;&#x3D;å¼€å‘ç¯å¢ƒä¸ä¼šå¯ç”¨ç¦»çº¿ç¼“å­˜ï¼Œå› ä¸ºé˜²æ­¢æœ‰ç¼“å­˜åè°ƒè¯•å›°éš¾<br>è¦æµ‹è¯•ç¦»çº¿åŠŸèƒ½ï¼Œå¿…é¡»ä½¿ç”¨ build åçš„ç”Ÿäº§ç‰ˆæœ¬ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm install -g serve</span><br><span class="line">serve dist</span><br><span class="line"></span><br><span class="line"><span class="comment">#or</span></span><br><span class="line"></span><br><span class="line">yarn build         <span class="comment"># æ„å»ºç”Ÿäº§ä»£ç </span></span><br><span class="line">npx serve dist     <span class="comment"># å¯åŠ¨æœ¬åœ°é™æ€æœåŠ¡å™¨ï¼ˆæ­£å¼ç¯å¢ƒï¼‰</span></span><br></pre></td></tr></table></figure>
<h2 id="é—®é¢˜æ±‡æ€»"><a href="#é—®é¢˜æ±‡æ€»" class="headerlink" title="é—®é¢˜æ±‡æ€»"></a>é—®é¢˜æ±‡æ€»</h2><h3 id="ä¸ä¿¡ä»»ã€è¯ä¹¦"><a href="#ä¸ä¿¡ä»»ã€è¯ä¹¦" class="headerlink" title="ä¸ä¿¡ä»»ã€è¯ä¹¦"></a>ä¸ä¿¡ä»»ã€è¯ä¹¦</h3><ol>
<li>Uncaught (in promise) SecurityError: Failed to register a ServiceWorker for scope (â€˜<a href="https://192.168.1.x:417x/">https://192.168.1.x:417x/</a>â€˜) with script (â€˜<a href="https://192.168.1.x:417x/sw.js">https://192.168.1.x:417x/sw.js</a>â€˜): An SSL certificate error occurred when fetching the script.<br>è¡¨ç¤ºæ­£åœ¨å°è¯•åœ¨ä½¿ç”¨ è‡ªç­¾åè¯ä¹¦æˆ–æ— æ•ˆ HTTPS è¯ä¹¦ çš„æœ¬åœ°å¼€å‘æœåŠ¡å™¨ä¸Šæ³¨å†Œ Service Workerï¼Œè€Œ æµè§ˆå™¨å‡ºäºå®‰å…¨åŸå› é˜»æ­¢äº†è¿™ä¸ªè¯·æ±‚ã€‚</li>
</ol>
<ul>
<li>è§£å†³æ–¹æ³• é€‰å…¶ä¸€<br>ï¼ˆ1ï¼‰ localhoståœ°å€æ˜¯okçš„ æˆ–è€…<br>ï¼ˆ2ï¼‰ä½¿ç”¨å—ä¿¡ä»»çš„è¯ä¹¦ï¼š<br>å¦‚æœä½  å¿…é¡»é€šè¿‡ IP åœ°å€ + HTTPS è®¿é—®ï¼Œä½ éœ€è¦ï¼š<br>ä¸ºä½ çš„ IP æˆ–æœ¬åœ°åŸŸåï¼ˆå¦‚ my-app.localï¼‰ç”Ÿæˆä¸€ä¸ªè‡ªç­¾åè¯ä¹¦ï¼›<br>å°†è¯¥è¯ä¹¦å¯¼å…¥åˆ°æœ¬åœ°çš„ã€Œå—ä¿¡ä»»æ ¹è¯ä¹¦ã€ï¼›<br>é…ç½® Vite ä½¿ç”¨è¯¥è¯ä¹¦ã€‚<br>è¿™è¿‡ç¨‹è¾ƒå¤æ‚ï¼Œé€šå¸¸ä¸æ¨èåœ¨æœ¬åœ°å¼€å‘ä¸­è¿™ä¹ˆåšï¼Œé™¤éä½ å¯¹è¯ä¹¦æ¯”è¾ƒç†Ÿæ‚‰ã€‚<br>1ï¼‰å®‰è£…</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install mkcert</span><br><span class="line">brew install nss <span class="comment"># å¦‚æœä½ ä½¿ç”¨ Firefox</span></span><br></pre></td></tr></table></figure>
<p>Windowsï¼šç›´æ¥åœ¨ <a target="_blank" rel="noopener" href="https://github.com/FiloSottile/mkcert">https://github.com/FiloSottile/mkcert</a> ä¸‹è½½å¯¹åº”ç‰ˆæœ¬ï¼Œè§£å‹åˆ° PATH ä¸­ã€‚<br>2ï¼‰åˆ›å»ºæœ¬åœ° CAï¼ˆä»…ç¬¬ä¸€æ¬¡éœ€è¦ï¼‰<code>mkcert -install</code>è¿™ä¼šè‡ªåŠ¨ç”Ÿæˆå¹¶å®‰è£…æœ¬åœ°æ ¹è¯ä¹¦åˆ°å—ä¿¡ä»»åˆ—è¡¨ä¸­ï¼ˆæ”¯æŒ macOSã€Windowsã€Linuxï¼‰ã€‚<br>3ï¼‰ä¸º IP åœ°å€åˆ›å»ºè¯ä¹¦ï¼ˆä¾‹å¦‚ 192.168.1.4ï¼‰<br>mkcert 192.168.1.4<br>ä¼šç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼š<br>192.168.1.4.pemï¼ˆè¯ä¹¦ï¼‰<br>192.168.1.4-key.pemï¼ˆç§é’¥ï¼‰<br>4) é…ç½® Vite ä½¿ç”¨è¿™ä¸ªè¯ä¹¦<br>å°†æ–‡ä»¶é‡å‘½åä¸ºæ›´ç®€æ´çš„åå­—ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> 192.168.1.4.pem server.crt</span><br><span class="line"><span class="built_in">mv</span> 192.168.1.4-key.pem server.key</span><br></pre></td></tr></table></figure>
<p>åœ¨ vite.config.ts ä¸­é…ç½®ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">server</span>: &#123;</span><br><span class="line">    <span class="attr">https</span>: &#123;</span><br><span class="line">      <span class="attr">key</span>: fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;./server.key&#x27;</span>),</span><br><span class="line">      <span class="attr">cert</span>: fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;./server.crt&#x27;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&#x27;192.168.1.4&#x27;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">4173</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨å¯ä»¥è®¿é—®ï¼š<a href="https://192.168.1.x:417xã€‚ä¸ä¼šæœ‰è¯ä¹¦è­¦å‘Šï¼Œä¸”">https://192.168.1.x:417xã€‚ä¸ä¼šæœ‰è¯ä¹¦è­¦å‘Šï¼Œä¸”</a> Service Worker èƒ½æ­£å¸¸æ³¨å†Œã€‚<br>2. æ¡Œé¢chromeçš„Service Worker æ­£å¸¸å·¥ä½œï¼Œå®‰å“chromeè¿˜æ˜¯æ²¡å­˜ä¸Š<br>æ‰‹æœºç«¯æ£€æŸ¥service workerï¼Œchrome:&#x2F;&#x2F;serviceworker-internals å·²è¢«åºŸå¼ƒï¼Œæ•…ä½¿ç”¨ï¼šåœ¨æ‰‹æœºä¸Šæ‰“å¼€ DevToolsï¼ˆæ¨èï¼‰<br>ç”µè„‘å’Œæ‰‹æœºè¿æ¥åŒä¸€ä¸ª Wi-Fi<br>æ‰‹æœºå¼€å¯å¼€å‘è€…æ¨¡å¼ + USB è°ƒè¯•<br>ç”¨æ•°æ®çº¿è¿æ¥ç”µè„‘<br>ç”µè„‘ Chrome æ‰“å¼€ï¼š<br>chrome:&#x2F;&#x2F;inspect&#x2F;#devices<br>åœ¨æ‰‹æœº Chrome ä¸­æ‰“å¼€ä½ è¦è°ƒè¯•çš„ç½‘é¡µ<br>ç”µè„‘ç«¯ç‚¹å‡» inspectï¼Œå°±èƒ½æ‰“å¼€è¯¥ç½‘é¡µçš„ DevToolsï¼ˆåƒæ¡Œé¢ä¸€æ ·è°ƒè¯•ï¼‰<br>åˆ‡æ¢åˆ° DevTools çš„ â€œApplicationâ€ â†’ â€œService Workersâ€ é¢æ¿æŸ¥çœ‹æ³¨å†Œæƒ…å†µ</p>
<ol start="3">
<li>An SSL certificate error occurred when fetching the script.äº†è§£æ­¤é”™è¯¯<br>index.html:1 Uncaught (in promise) SecurityError: Failed to register a ServiceWorker for scope (â€˜<a target="_blank" rel="noopener" href="https://xx/">https://xx/</a>â€˜) with script (â€˜<a target="_blank" rel="noopener" href="https://xx/sw.js">https://xx/sw.js</a>â€˜): An SSL certificate error occurred when fetching the script.<br>è¯•å›¾åœ¨ HTTPS æœ¬åœ°å¼€å‘ç¯å¢ƒ æ³¨å†Œ Service Workerï¼Œä½†æµè§ˆå™¨å› ä¸º SSL è¯ä¹¦ä¸å—ä¿¡ä»» è€Œé˜»æ­¢äº†æ³¨å†Œã€‚<br>å¿…é¡»æŠŠè¯ä¹¦ xx.pem å®‰è£…åˆ°æ‰‹æœºä¸Šï¼Œå®‰è£…åè¿˜è¦å¯ç”¨â€œä¿¡ä»»ç”¨æˆ·è¯ä¹¦â€ï¼ˆå®‰å“è®¾ç½®ä¸­ï¼‰ï¼Œå¦åˆ™æµè§ˆå™¨ä¾ç„¶ä¼šæŠ¥â€œSSL è¯ä¹¦é”™è¯¯â€ï¼ŒService Worker æ— æ³•æ³¨å†Œã€‚<br>1ï¼‰å‡†å¤‡è¯ä¹¦ï¼ˆæŠŠ .pem è½¬ä¸º .crtï¼‰å®‰å“åªè¯†åˆ« .crt æ ¼å¼è¯ä¹¦ã€‚åœ¨ç”µè„‘ä¸ŠæŠŠ .pem è½¬ä¸º .crtï¼šæ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œï¼š<code>cp 192.168.1.4.pem 192.168.1.4.crt</code>ç®€å•æ”¹æ‰©å±•åï¼Œå› ä¸º mkcert ç”Ÿæˆçš„ .pem å®é™…ä¸Šå°±æ˜¯ X.509 æ ¼å¼ã€‚</li>
</ol>
<ol start="2">
<li>æŠŠè¯ä¹¦ä¼ åˆ°æ‰‹æœº<br>3)å®‰è£…è¯ä¹¦  ä¸åŒå‚å•†ç•Œé¢ç•¥æœ‰ä¸åŒ</li>
</ol>
<ul>
<li>å®‰å“10<br>æ‰“å¼€è®¾ç½® â†’ å®‰å…¨ æˆ– å®‰å…¨ä¸éšç§<br>é€‰æ‹©ï¼šåŠ å¯†ä¸å‡­æ® æˆ– æ›´å¤šå®‰å…¨è®¾ç½®<br>ç‚¹å‡»ï¼šä»å­˜å‚¨è®¾å¤‡å®‰è£… æˆ– å®‰è£…è¯ä¹¦<br>é€‰æ‹©ä½ åˆšæ‰ä¼ è¿›å»çš„è¯ä¹¦<br>é€‰æ‹©å®‰è£…ä¸ºï¼šã€VPN å’Œåº”ç”¨ç¨‹åºï¼ˆç”¨æˆ·ï¼‰ã€‘<br>æ‰‹æœºæç¤ºâ€œå·²å®‰è£…è¯ä¹¦â€ï¼Œè¯´æ˜æˆåŠŸã€‚</li>
</ul>
<ol start="4">
<li>å¼€å¯ä¿¡ä»»ç”¨æˆ·è¯ä¹¦ï¼ˆæŸäº›å®‰å“å¿…é¡»ï¼‰<br>éƒ¨åˆ†å®‰å“ç³»ç»Ÿï¼ˆå°¤å…¶æ˜¯ Android 11 åŠä»¥ä¸Šï¼‰é»˜è®¤ä¸ä¿¡ä»»ç”¨æˆ·å®‰è£…çš„è¯ä¹¦ï¼Œä½ éœ€è¦æ‰‹åŠ¨å¼€å¯ï¼š<br>æ‰“å¼€æµè§ˆå™¨è¾“å…¥ chrome:&#x2F;&#x2F;flagsï¼Œæœç´¢ â€œinsecure origins treated as secureâ€<br>æˆ–æ‰‹åŠ¨å¯ç”¨ï¼šè®¾ç½® â†’ å…³äºæ‰‹æœº â†’ è¿ç»­ç‚¹å‡»ç‰ˆæœ¬å· 7 æ¬¡ï¼Œå¼€å¯å¼€å‘è€…æ¨¡å¼&#x2F;ã€å¼€å‘è€…é€‰é¡¹ã€‘<br>æ‰¾åˆ°ï¼šä¿¡ä»»ç”¨æˆ· CA è¯ä¹¦æˆ–ç±»ä¼¼é€‰é¡¹ï¼šå…è®¸åº”ç”¨ä¿¡ä»»ç”¨æˆ· CA<br>âš ï¸ æ³¨æ„ï¼šä¸æ˜¯æ‰€æœ‰ ROM éƒ½æä¾›è¿™ä¸ªé€‰é¡¹ï¼Œå¦‚æœä½ çš„æµè§ˆå™¨ï¼ˆå°¤å…¶æ˜¯ Chromeï¼‰ä»ç„¶ä¸ä¿¡ä»»ç”¨æˆ·è¯ä¹¦ï¼Œå°±åªèƒ½éƒ¨ç½²åˆ°æ”¯æŒ HTTPS çš„è¿œç¨‹æœåŠ¡å™¨ï¼ˆå¦‚ Vercelï¼‰ã€‚<br>5ï¼‰ éªŒè¯æ˜¯å¦æˆåŠŸ<br>æ‰“å¼€æ‰‹æœºæµè§ˆå™¨ï¼Œè®¿é—®ï¼Œçœ‹åœ°å€æ æ˜¯å¦å‡ºç°ç»¿è‰² ğŸ”’ æˆ–æ— è­¦å‘Š<br>æ‰“å¼€ DevTools è°ƒè¯•ï¼ˆç”¨ chrome:&#x2F;&#x2F;inspectï¼‰æŸ¥çœ‹ Service Worker æ˜¯å¦æ­£å¸¸æ³¨å†Œ</li>
</ol>
<ol start="4">
<li>åœ¨å®‰å“ä¸­æç¤ºâ€œéœ€è¦æä¾›ç§é’¥æ‰èƒ½å®‰è£…è¯ä¹¦â€ã€‚<br>ç”¨adbå®‰è£…åˆ°ç³»ç»Ÿè¯ä¹¦ æˆ–ç”¨opensslè½¬æ¢ä¸€ä¸‹å†å®‰è£…<br>ä½ å¯¼å…¥çš„æ˜¯ å®¢æˆ·ç«¯è¯ä¹¦ï¼ˆClient Certificateï¼‰ï¼Œè€Œç³»ç»Ÿå®‰è£…æ—¶éœ€è¦ï¼š<br>å…¬é’¥ + ç§é’¥ï¼Œå¹¶ä¸”è¦æ‰“åŒ…æˆ .p12ï¼ˆæˆ– .pfxï¼‰æ ¼å¼ã€‚<br>è§£å†³åŠæ³•ï¼šç”Ÿæˆ .p12 æ–‡ä»¶ï¼ˆå«ç§é’¥ï¼‰<br>ä½ éœ€è¦ç”¨ openssl å°†ä½ çš„å…¬é’¥å’Œç§é’¥æ‰“åŒ…æˆä¸€ä¸ª .p12 æ–‡ä»¶ï¼Œå†ä¼ åˆ°æ–‡çŸ³è®¾å¤‡ä¸Šå®‰è£…ã€‚<br>æ‰€éœ€ææ–™ï¼šä¸€ä¸ª .crtï¼ˆæˆ– .pemï¼‰æ–‡ä»¶ï¼šå…¬é’¥è¯ä¹¦ï¼Œä¸€ä¸ª .key æ–‡ä»¶ï¼šç§é’¥æ–‡ä»¶ï¼ˆå¿…é¡»ä½ è‡ªå·±æŒæœ‰ï¼‰</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ‰“åŒ…å‘½ä»¤</span></span><br><span class="line">openssl pkcs12 -<span class="built_in">export</span> \</span><br><span class="line">  -<span class="keyword">in</span> client.crt \</span><br><span class="line">  -inkey client.key \</span><br><span class="line">  -out client.p12 \</span><br><span class="line">  -name <span class="string">&quot;my-cert&quot;</span></span><br></pre></td></tr></table></figure>
<p>ç³»ç»Ÿä¼šè¦æ±‚ä½ è®¾ç½®ä¸€ä¸ªå¯¼å…¥å¯†ç ï¼ˆå¯ä»¥è®¾ç½®ä¸€ä¸ªç®€å•å¯†ç ï¼‰è®¾å¤‡å®‰è£…æ—¶è¦æ±‚è¾“å…¥<br>5. ä¸Šè¿°åšå®Œï¼Œå®‰å“chromeè¿˜æ˜¯ä¸ä¿¡ä»»è¯¥ç½‘ç«™</p>
<ul>
<li>ä½¿ç”¨vite-plugin-mkcert<br>è¿™æ˜¯ä¸€ä¸ª Vite æ’ä»¶ï¼Œç”¨äºï¼š<br>ä¸ºä½ çš„æœ¬åœ°å¼€å‘æœåŠ¡å™¨ï¼ˆvite devï¼‰å¯ç”¨ HTTPS<br>è‡ªåŠ¨åˆ›å»ºå¹¶å®‰è£…å—ä¿¡ä»»çš„æœ¬åœ°å¼€å‘è¯ä¹¦ï¼ˆé€šè¿‡ mkcertï¼‰<br>è¿™å¯¹åœ¨ ç§»åŠ¨è®¾å¤‡ï¼ˆå¦‚æ–‡çŸ³ï¼‰ä¸Šè®¿é—®ä½ çš„æœ¬åœ°å¼€å‘é¡µé¢ éå¸¸é‡è¦ï¼Œå› ä¸ºï¼š<br>ç§»åŠ¨ç«¯é€šå¸¸æ‹’ç»è¿æ¥æœªä¿¡ä»»çš„ HTTP æˆ–è‡ªç­¾å HTTPSï¼Œå¦‚æœä½ é…ç½®äº† mkcertï¼Œæµè§ˆå™¨å°±å¯ä»¥ç›´æ¥ä¿¡ä»»ä½ çš„æœ¬åœ° HTTPS ç½‘ç«™</li>
<li>è¿˜æ˜¯ä¸è¡Œï¼Œè¯•ä¸€ä¸‹ï¼šæŠŠè¯ä¹¦æ”¾è¿›ç³»ç»Ÿ CA ç›®å½•<br>mkcert å®‰è£…æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªã€Œæ ¹è¯ä¹¦ï¼ˆCAï¼‰ã€ç”¨äºç­¾å‘ä½ æœ¬åœ°å¼€å‘ç”¨çš„ HTTPS è¯ä¹¦ã€‚è¿™ä¸ªæ ¹è¯ä¹¦æ˜¯ä½ è¦å¯¼å…¥å®‰å“ç³»ç»Ÿ CA çš„é‚£ä¸ªè¯ä¹¦ï¼Œ<code>mkcert -CAROOT</code>æ‰¾åˆ°ä½ç½®<br>æ²¡rootçš„å°†rootCA.pemå‘é€åˆ°æ‰‹æœºï¼Œç›´æ¥å®‰è£…æˆCAè¯ä¹¦ï¼Œ&#x3D;&#x3D;æˆåŠŸè®©chromeä¿¡ä»»äº†ï¼Œè§£å†³é—®é¢˜âœ…&#x3D;&#x3D;<br><code>openssl x509 -inform PEM -subject_hash_old -in rootCA.pem | head -1</code>ç”Ÿæˆä¸€ä¸²å­—ç¬¦ä¸²ï¼Œè®°ä½å®ƒï¼Œåé¢åŠ ä¸Š<code>.0</code>ä½œä¸ºæ–°æ–‡ä»¶çš„åç§°<br><code>cp rootCA.pem æ–°æ–‡ä»¶åç§°</code>å½¢å¦‚<code>cp rootCA.pem 119xxxxa.0</code><br>é€šè¿‡adbå‘½ä»¤æ”¾å…¥å·²rootçš„è®¾å¤‡</li>
</ul>
<h3 id="åˆ·æ–°PWA-è®©å…¶ä¼˜å…ˆä½¿ç”¨ç½‘ç»œçš„ç»“æœï¼ˆå¦‚æœæœ‰ï¼‰"><a href="#åˆ·æ–°PWA-è®©å…¶ä¼˜å…ˆä½¿ç”¨ç½‘ç»œçš„ç»“æœï¼ˆå¦‚æœæœ‰ï¼‰" class="headerlink" title="åˆ·æ–°PWA è®©å…¶ä¼˜å…ˆä½¿ç”¨ç½‘ç»œçš„ç»“æœï¼ˆå¦‚æœæœ‰ï¼‰"></a>åˆ·æ–°PWA è®©å…¶ä¼˜å…ˆä½¿ç”¨ç½‘ç»œçš„ç»“æœï¼ˆå¦‚æœæœ‰ï¼‰</h3><ol>
<li>vitePWAä½¿ç”¨äº†Network First  è¿˜æ˜¯ä¸è¡Œ</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//vitepwaè®¾ç½®</span></span><br><span class="line"><span class="attr">workbox</span>: &#123;</span><br><span class="line">		<span class="attr">clientsClaim</span>: <span class="literal">true</span>,<span class="comment">//æ–° Service Worker æ¿€æ´»åç«‹å³æ¥ç®¡æ‰€æœ‰å®¢æˆ·ç«¯é¡µé¢</span></span><br><span class="line">        <span class="attr">skipWaiting</span>: <span class="literal">true</span>,<span class="comment">//å®‰è£…å®Œæ–° Service Worker åç«‹å³æ¿€æ´»ï¼Œä¸ç­‰æ—§é¡µé¢å…³é—­</span></span><br><span class="line">        <span class="comment">/*ä¸Šè¿°è¿™ä¸¤ä¸ªæ…é€‰ï¼Œå¦‚æœæ›´æ–°ç¼“å­˜ä¸åŠæ—¶ï¼Œå¯ä»¥è¯•è¯•*/</span></span><br><span class="line">        <span class="attr">globPatterns</span>: [<span class="string">&#x27;**/*.&#123;js,css,html,ico,png,svg,json,txt,woff2,md&#125;&#x27;</span>], <span class="comment">// âœ… ç¼“å­˜è¿™äº›åç¼€çš„æ–‡ä»¶</span></span><br><span class="line">        <span class="attr">runtimeCaching</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">urlPattern</span>: <span class="regexp">/^\/.*\.(json|png|ico|svg|html|js|css|txt|md)$/</span>,<span class="comment">//è¦åŒ…å«è¦åˆ·æ–°çš„urlè·¯å¾„</span></span><br><span class="line">            <span class="attr">handler</span>: <span class="string">&#x27;NetworkFirst&#x27;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="attr">cacheName</span>: <span class="string">&#x27;public-assets-cache&#x27;</span>,</span><br><span class="line">              <span class="attr">expiration</span>: &#123;</span><br><span class="line">                <span class="attr">maxEntries</span>: <span class="number">1000</span>, <span class="comment">// æœ€å¤šç¼“å­˜ 1000 ä¸ªèµ„æº</span></span><br><span class="line">                <span class="attr">maxAgeSeconds</span>: <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">15</span>, <span class="comment">// ç¼“å­˜ 15 å¤©</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="attr">networkTimeoutSeconds</span>: <span class="number">5</span>,<span class="comment">//ç­‰å¾…ç½‘ç»œå“åº”æœ€é•¿æ—¶é—´</span></span><br><span class="line">              <span class="attr">cacheableResponse</span>: &#123; <span class="attr">statuses</span>: [<span class="number">0</span>, <span class="number">200</span>] &#125;,<span class="comment">//0æˆ–200çŠ¶æ€ç æ‰ç¼“å­˜</span></span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>æ¡Œé¢webå¯ä»¥è·å–åˆ°æœ€æ–°çš„æ›´æ–°ï¼Œç§»åŠ¨ç«¯æ‰“å¼€ç½‘é¡µåˆ·æ–°è¿˜æ˜¯ä¸è¡Œ<br>è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„ PWA é—®é¢˜ï¼Œæ¡Œé¢ç«¯åˆ·æ–°èƒ½æ›´æ–°ï¼Œç§»åŠ¨ç«¯å´æ€»æ˜¯å¡ä½æ—§ç‰ˆæœ¬ã€‚è¿™ä¸ªç°è±¡å¤§å¤šæ•°æ˜¯å› ä¸º ç§»åŠ¨æµè§ˆå™¨çš„ PWA ç¼“å­˜æœºåˆ¶æ›´ aggressiveï¼ˆæ¿€è¿›ï¼‰ï¼Œè€Œä¸”å¾ˆå¤šæ—¶å€™å®ƒä»¬ä¸ä¼šé‡æ–°æ‹‰å– Service Workerï¼Œå³ä½¿ä½ åœ¨åˆ·æ–°é¡µé¢ã€‚</li>
</ol>
<ul>
<li><code>registerType: &#39;autoUpdate&#39; </code>åªæ˜¯è®©æµè§ˆå™¨æ£€æŸ¥æ–°ç‰ˆæœ¬ï¼Œä¸ä¼šè‡ªåŠ¨æ¿€æ´»æ–°ç‰ˆæœ¬å¹¶æ›¿æ¢å½“å‰é¡µé¢ã€‚éœ€è¦æ·»åŠ æ‰‹åŠ¨æ›´æ–°é€»è¾‘</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¿™ä¸ªæœºåˆ¶ï¼šæ£€æµ‹åˆ°æ–° SW â†’ æç¤ºç”¨æˆ· â†’ ç”¨æˆ·ç‚¹å‡»åˆ·æ–° â†’ æ¿€æ´»æ–°ç‰ˆæœ¬ â†’ é¡µé¢ reload</span></span><br><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; registerSW &#125; <span class="keyword">from</span> <span class="string">&#x27;virtual:pwa-register&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> updateSW = <span class="title function_">registerSW</span>(&#123;</span><br><span class="line">  <span class="title function_">onNeedRefresh</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// âœ… è¿™é‡Œæ˜¯å…³é”®ï¼šæç¤ºç”¨æˆ·ç‚¹å‡»æ›´æ–°</span></span><br><span class="line">    <span class="keyword">const</span> confirmUpdate = <span class="variable language_">window</span>.<span class="title function_">confirm</span>(<span class="string">&#x27;å‘ç°æ–°ç‰ˆæœ¬ï¼Œæ˜¯å¦ç«‹å³æ›´æ–°ï¼Ÿ&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (confirmUpdate) &#123;</span><br><span class="line">      <span class="title function_">updateSW</span>(<span class="literal">true</span>)  <span class="comment">// å¼ºåˆ¶è·³è½¬å¹¶æ¿€æ´»æ–°çš„ Service Worker</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onOfflineReady</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;åº”ç”¨ç¼“å­˜å®Œæˆï¼Œå¯ç¦»çº¿ä½¿ç”¨&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//typescriptç±»å‹å®šä¹‰ æ”¾åœ¨src/shims-vue.d.ts</span></span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;virtual:pwa-register&#x27;</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢è¿™ä¸ªregisterSW æ˜¯è¿è¡Œæ—¶è§¦å‘æµè§ˆå™¨æ³¨å†Œ Service Workerï¼Œä¸éœ€è¦ä¾èµ– Vue å®ä¾‹ï¼Œæ‰€ä»¥ä¸éœ€è¦åœ¨æ–‡ä»¶ä¸­è·Ÿappæœ‰ä»€ä¹ˆè”ç³»ã€‚<br>æ”¾åœ¨é¡¶å±‚å¯ä»¥ç¡®ä¿æ— è®ºä½ ç”¨ä»€ä¹ˆæ¡†æ¶ï¼ˆVue&#x2F;React&#x2F;Svelteï¼‰ï¼ŒPWA æ³¨å†Œé€»è¾‘éƒ½èƒ½ç«‹å³è¿è¡Œã€‚ç”šè‡³å¯ä»¥æ”¾åœ¨å…¥å£ HTML çš„<code>&lt;script&gt;</code>æ ‡ç­¾é‡Œéƒ½èƒ½è·‘ã€‚</p>
<ul>
<li>&#x3D;&#x3D;IOSç³»ç»Ÿæœ€å¥½è®¾ç½®æ‰‹åŠ¨æŒ‰é’® &#x2F; æœåŠ¡å™¨ index.html è®¾ç½® no-cache &#x2F; no-store å“åº”å¤´&#x3D;&#x3D; ä¸ç„¶æœ‰å¯èƒ½è¿˜æ˜¯ä¸èƒ½è‡ªåŠ¨æ›´æ–°PWA<br>åœ¨ iOS PWA é‡Œï¼Œå› ä¸ºç³»ç»Ÿé™åˆ¶è‡ªåŠ¨åˆ·æ–°æ›´æ–°å¾ˆéš¾åšåˆ°ï¼Œç»™ç”¨æˆ·ä¸€ä¸ª<strong>æ‰‹åŠ¨åˆ·æ–°æŒ‰é’®</strong>æ˜¯éå¸¸å®ç”¨ä¸”å¸¸è§çš„æ–¹æ¡ˆã€‚iOS Safari çš„ PWA ä¸ä¼šè‡ªåŠ¨æ¿€æ´»æ–°çš„ Service Workerï¼Œå³ä½¿æœ‰æ–°ç‰ˆæœ¬ä¹Ÿä¸è‡ªåŠ¨åˆ·æ–°é¡µé¢ã€‚</li>
</ul>

            </div>
        </div>
    </article>

    
    
<nav class="article-nav">
  
    <a href="/2025/07/20/%E6%87%92%E5%8A%A0%E8%BD%BD%E9%A2%84%E5%8A%A0%E8%BD%BD/" id="article-nav-newer" class="article-nav-link-wrap prev">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          æ‡’åŠ è½½é¢„åŠ è½½
        
      </div>
    </a>
  
  
    <a href="/2025/07/16/nodejs%E6%A8%A1%E5%9D%97%E5%A4%A7%E5%85%A8/" id="article-nav-older" class="article-nav-link-wrap next">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">nodejsæ¨¡å—å¤§å…¨</div>
    </a>
  
</nav>

    

    
</div>
    </div>
    <footer class="site-footer">
        <div class="global-width">
            <ul class="site-widget">
                
                <li class="widget widget-tag">
                    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/English/" rel="tag">English</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/basics/" rel="tag">basics</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/frontend/" rel="tag">frontend</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/projects/" rel="tag">projects</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tags/" rel="tag">tags</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/test/" rel="tag">test</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

                </li>
                
                <li class="widget widget-category">
                    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/daily-report/">daily_report</a><span class="category-list-count">52</span></li></ul>
    </div>
  </div>

                </li>
                
                <li class="widget widget-recent_posts">
                    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget-body">
      <ul>
        
          <li>
            <a href="/2025/07/21/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/">å¾®ä¿¡å°ç¨‹åº</a>
          </li>
        
          <li>
            <a href="/2025/07/20/%E6%87%92%E5%8A%A0%E8%BD%BD%E9%A2%84%E5%8A%A0%E8%BD%BD/">æ‡’åŠ è½½é¢„åŠ è½½</a>
          </li>
        
          <li>
            <a href="/2025/07/20/PWA/">PWA</a>
          </li>
        
          <li>
            <a href="/2025/07/16/nodejs%E6%A8%A1%E5%9D%97%E5%A4%A7%E5%85%A8/">nodejsæ¨¡å—å¤§å…¨</a>
          </li>
        
          <li>
            <a href="/2025/07/15/nodejs%E4%B8%80%E6%9C%AC%E9%80%9A/">nodejsä¸€æœ¬é€š</a>
          </li>
        
      </ul>
    </div>
  </div>

                </li>
                
            </ul>
        </div>
        <div class="site-info">
            <address>
                &copy; 2014 <a href="https://70v-yoyo.github.io">Yoyo&#39;s blog</a> All Right Reserved. <br/>
                Powered by <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a>. Theme by <a target="_blank" rel="noopener" href="http://zzoman.com">ZZOMAN</a>
                <p><a target="_blank" href="https://github.com/70v-Yoyo">My github</a></p>
            </address>
        </div>
    </footer> 
    
    
    <script src="/libs/jquery-1.11.3.min.js" type="text/javascript"></script>
    
    <script src="/libs/fancybox/jquery.fancybox.js" type="text/javascript"></script>
    
    <script src="/js/site_init.js" type="text/javascript"></script>
     
    <noscript>
        <style>
            article {
                position: absolute;
                width: 0;
                height: 0;
                overflow: hidden;
                opacity: 0;
            }

        </style>
        <h1>JSå·²è¢«ç¦ç”¨</h1>
    </noscript>
<!-- hexo injector body_end start -->
    <script>
      (function() {
        function moveElementIfSmallScreen() {
          const toc = document.getElementById('fixed-toc-container');
          const article = document.querySelector("article");
          const toggleBtn = document.getElementById('toggle_btn');
          if (!toc || !article) return;
          if (window.innerWidth < 1024 && article.firstElementChild !== toc) {
            console.log('small screen!!')
            
            article.insertBefore(toc, article.firstChild);//ç§»åŠ¨èŠ‚ç‚¹ï¼Œè€Œéå¤åˆ¶
            
            toggleBtn.style.display='none';
            // æ›¿æ¢æ ·å¼ï¼šå–æ¶ˆ fixedï¼Œè®¾ç½®é€‚åˆæ­£æ–‡çš„æ ·å¼
            toc.style.position = 'relative';
            toc.style.top = '';
            toc.style.left = '';
            toc.style.width = '100%';
            toc.style.maxHeight = 'none';
            toc.style.overflowY = 'visible';
            toc.style.overflowX = 'visible';
            toc.style.padding = '1em';
            toc.style.borderLeft = 'none';
            toc.style.borderBottom = '1px solid #ddd';
            toc.style.background = '#f9f9f9';
            toc.style.opacity = '1';
            toc.style.zIndex = '9999';
            toc.style.boxShadow = 'none';
            toc.style.margin = '1rem';
            toc.style.paddingTop= '2rem';
          }
        }
        window.addEventListener("DOMContentLoaded", moveElementIfSmallScreen);
        window.addEventListener("resize", moveElementIfSmallScreen);
      })();
    </script>
  <!-- hexo injector body_end end -->
    <div id="fixed-toc-container" style="
      position: fixed;
      top: 0vh;
      left: 0px;
      width: 15rem;
      max-height: 80vh;
      overflow-y: auto;
      overflow-x: auto;
      padding: 10px;
      border-left: 2px solid #ccc;
      font-size: 14px;
      line-height: 1.5;
      background: #fff;
      opacity:0.8;
      z-index: 9999;
      box-shadow:
        0 2px 4px rgba(0, 0, 0, 0.05),  /* ç¬¬ä¸€å±‚ï¼šè¿‘å¤„æŸ”å’Œ */
        0 8px 16px rgba(0, 0, 0, 0.08); /* ç¬¬äºŒå±‚ï¼šè¿œå¤„æ‰©æ•£ */
    ">
      <strong>Contents</strong>
      <div id="toggle_btn" style="
      position:absolute;
      right:1rem;
      display:inline-block;
      width:2rem;
      text-align:center;
      border:1px solid #ccc;
      "><</div>
      <ul id="fixed-toc-list" style="list-style: none; padding-left: 10px;"></ul>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const nav = document.querySelector('nav');
        if (nav) {
          const navBottom = nav.getBoundingClientRect().bottom;//æµè§ˆå™¨JS API
          console.log('nav bottom:', navBottom);
          // è®¾ç½®tocå…ƒç´  top = nav bottom
          const toc = document.querySelector('#fixed-toc-container');
          if (toc) {
            toc.style.top = navBottom + 'px';
            toc.style.maxHeight=window.innerHeight - navBottom.getBoundingClientRect().bottom;
          }
        }
      });

      const myDiv = document.getElementById('toggle_btn');
      var tocList=document.getElementById("fixed-toc-list");
      var tocContainer=document.getElementById("fixed-toc-container");
      function handleClickBtn() {
        console.log('Div è¢«ç‚¹å‡»äº†ï¼');
        if(myDiv.textContent==='<'){
          myDiv.textContent ='>'
          tocList.style.display='none'
          tocContainer.style.width='11rem'
        }else{
          myDiv.textContent ='<'
          tocList.style.display='block'
          tocContainer.style.width='15rem'
        }
          
      }


      myDiv.addEventListener('click', handleClickBtn);// ç»‘å®šç‚¹å‡»äº‹ä»¶


      (function() {
      const Patternstr = "/*\\d{4}/\\d{2}/\\d{2}/.*"; //æœ¬èº«æ˜¯å­—ç¬¦ä¸²æ’å…¥ï¼Œæ‰€ä»¥å¯¹ç¬¦å·è¦è½¬ä¹‰
      //"^//*"->"/"
      //"/.*"->".*"
      //JSå¼•æ“ä¸­""è½¬ä¹‰
      //æ­£åˆ™è¡¨è¾¾å¼å¼•æ“ä¹Ÿæ˜¯""è½¬ä¹‰
      const dataPattern = new RegExp(Patternstr);
      const path = window.location.pathname;
      console.log(dataPattern.toString(),path,dataPattern.test(path));//æ§åˆ¶å°åœ¨æ¸²æŸ“æ—¶çœç•¥äº†åæ–œæ çš„å¯è§†è¡¨ç¤ºã€‚
      if (!dataPattern.test(path)&&(path==='/'||path==='index.html')) {
        console.log('no toc')
        let toc = document.getElementById('fixed-toc-container');
        if (toc) toc.style.display = 'none';
        return;
      }
        var content = document.querySelector('body');
        console.log('content',content)
        //var tocList = document.getElementById('fixed-toc-list');
        if (!content || !tocList) {
          document.getElementById('fixed-toc-container').style.display = 'none';
          return;
        }
        var headings = content.querySelectorAll('h1, h2, h3, h4');
        console.log('headings',headings)
        if(headings){
          const h1Element=headings[0];
          const rect = h1Element.getBoundingClientRect();
          if(rect.left<150){
           tocContainer.style.right='0px';
           tocContainer.style.left = 'auto'; // ç§»é™¤å†…è”çš„ left æ ·å¼
            //ä¸æ˜¯è®¾ç½®right:0 å°±æ›¿æ¢left:0 éœ€è¦ç§»é™¤
            console.log('to right')
          }
          console.log(rect.left,'150')
        }
        
        if (headings.length === 0) {
          document.getElementById('fixed-toc-container').style.display = 'none';
          return;
        }
        headings.forEach(function(heading, i) {
          if (!heading.id) {
            heading.id = 'heading-' + i;
          }
        });
        headings.forEach(function(heading) {
          var level = parseInt(heading.tagName.substring(1));
          var li = document.createElement('li');
          li.style.marginLeft = (level - 1) * 15 + 'px';
          var a = document.createElement('a');
          a.href = '#' + heading.id;
          a.textContent = heading.textContent;
          a.style.color = '#555';
          a.style.textDecoration = 'none';
          a.onmouseover = function() { a.style.textDecoration = 'underline'; };
          a.onmouseout = function() { a.style.textDecoration = 'none'; };
          li.appendChild(a);
          tocList.appendChild(li);
        });
      })();
    </script>
  </body>
</html>
